# AGENTS Guide for DeiAsPie.github.io
_Template seed: Legacy `AGENTS.md` (2024 snapshot); awesome-copilot template loader unavailable in this workspace._

## Project snapshot
- **Stack**: Hugo (`themes/curated/`) + Tailwind CSS v4 + vanilla JS enhancements in `assets/js/`.
- **Goals**: fast static site serving recommendations; dark-mode first; strict accessibility, Lighthouse, and template-safety gates.
- **Dependencies**: Node 22 LTS, Hugo Extended, Python 3.11 for template safety tests.

## Daily commands
- Install once: `npm install`
- Live preview: `npm run dev` (`hugo server --disableFastRender`); drafts with `hugo server -D`
- Build CSS: `npm run build:css` → writes `assets/gen/tailwind.css`
- Production build: `npm run build` (dev) or `npm run build:prod` (minify + garbage collect)
- Format: `npm run format`
- Python tests: `npm test` or `pytest -q tests/test_forbidden_templates.py`
- Audits: `npx -y @lhci/cli autorun --config=ci/lighthouserc.json`, `npx -y @axe-core/cli http://localhost:1313/`

## Architecture & content flow
- **Content-first**: author page bundles under `content/recommendations/<slug>/index.md`; colocate images in the same folder.
- **Courses hub**: `content/recommendations/courses/<slug>/index.md` must include an `area` list for grouping.
- **Theme**: shared layouts live in `themes/curated/layouts/`; project overrides go in `layouts/`.
- **Assets**: Tailwind entry `assets/css/main.css`; generated CSS saved to `assets/gen/` and ignored in Git. JS helpers (theme toggle, UI, prefetch) live in `assets/js/`.
- **SEO/metadata**: handled via `layouts/partials/seo-jsonld.html` and head partials; edit there instead of duplicating tags.

## File layout & artifacts
| Location | Purpose |
| --- | --- |
| `content/` | Markdown sources. Use bundles for new entries; legacy single files still render.
| `layouts/` | Project-specific partials/shortcodes overriding the theme.
| `themes/curated/` | Upstream theme; keep local edits minimal and documented.
| `assets/css/main.css` | Tailwind directives + lightweight component styles.
| `assets/gen/tailwind.css` | Generated by `npm run build:css`; never commit.
| `assets/js/*.js` | Progressive enhancement scripts (theme toggle, UI, prefetch).
| `static/` | Copy-as-is assets (`static/images`, `static/pagefind`, etc.).
| `scripts/` | Node helpers: Lighthouse (`run_lighthouse.mjs`), Axe (`run_axe.mjs`), CSS budget (`check_css_size.js`).
| `ci/lighthouse/` | LHCI HTML/JSON reports (treated as _reports_ folder).
| `ci/axe/` | Axe JSON outputs (fulfills requested _json_ artifacts).
| `public/`, `resources/` | Hugo build + cache output. Remove with task "Remove build artifacts".
| `docs/` | Manual documentation (e.g., `docs/CSP.md`).
| `uploaded_files/`, `extracted/` | Not used in this project; no ingestion pipeline currently.

## Environment variables
| Variable | When | Notes |
| --- | --- | --- |
| `AXE_URLS` | `scripts/run_axe.mjs` / `npm run axe` | Comma or whitespace list of URLs to audit; required.
| `LH_URLS` | `scripts/run_lighthouse.mjs` | Comma list of URLs. CI sets quality thresholds via `LH_MIN_PERF`, `LH_MIN_A11Y`, `LH_MIN_SEO`, `LH_MIN_BP`.
| `CSS_BUDGET_KIB` | CI budget step | Set automatically before `check_css_size.js`; set manually to enforce locally if desired.
| `CHROME_PATH` / `LHCI_*` | Optional | Auto-detected. Override if Chrome lives outside standard paths.
| `PLAYWRIGHT_BROWSERS_PATH` | Optional | Custom Playwright cache directory when running audits in constrained environments.

## Automation & QA gates
- `.github/workflows/ci.yml` builds CSS, enforces the CSS budget, runs pytest, builds Hugo, then executes Lighthouse + Axe (serious/critical blocking) using Playwright Chromium.
- `.github/workflows/deploy.yml` publishes `main` to GitHub Pages; runs after CI success.
- `.github/workflows/codeql-analysis.yml` keeps CodeQL scanning active for JS security regressions.
- Generated audit artifacts (`ci/lighthouse`, `ci/axe`) are uploaded each CI run for review.

## Tests & safety checks
- `tests/test_forbidden_templates.py` blocks inline event handlers (`onclick=`, `onload=`, `onerror=`) and unsafe string fragments across `layouts/` and `themes/`.
- Run `npm run build:css` before any Hugo build to avoid missing CSS or stale budgets.
- Tailwind content paths include `content/**/*.{md,html}`, `layouts/**/*.html`, `themes/curated/layouts/**/*.html`, `assets/js/**/*.js`; keep new templates inside these roots or update `tailwind.config.js`.
- Prefer Prettier (`npm run format`) before committing; Python scripts may add type hints but stay focused and pure.

## Gotchas & working tips
- Do **not** commit `public/`, `resources/`, or anything under `assets/gen/`.
- Keep course images within bundles so automatic OpenGraph and responsive partials can locate them.
- When adding JS, respect CSP direction in `docs/CSP.md`; keep scripts external and minimal.
- CI budget is current CSS size * 1.15. Large visual changes often require updating Tailwind usage rather than relaxing the budget.
- Review `README.md` for deeper explanations of SEO, accessibility, and future ideas before large refactors.

## Provider & OCR interfaces
None. The site is static; there are no provider APIs or OCR pipelines to integrate.

## References
- `README.md` — development workflow, content model, SEO/a11y notes.
- `hugo.toml` — menus, params, Goldmark configuration, and default metadata.
- `docs/CSP.md` — security posture for inline assets.
- `scripts/run_lighthouse.mjs`, `scripts/run_axe.mjs`, `scripts/check_css_size.js` — audit and budget automation.
