{{ define "main" }}
<article>
  <header class="mb-8">
    <h1 class="text-3xl font-bold mb-2">{{ .Title }}</h1>
    {{/* Show back link only for recommendation pages; route courses to their hub */}}
    {{ $.Scratch.Set "back" "" }}
    {{ if eq .Section "recommendations" }}
    {{ if and .CurrentSection (eq .CurrentSection.RelPermalink "/recommendations/courses/") }}
    {{ $.Scratch.Set "back" ("/recommendations/courses/" | relURL) }}
    {{ else }}
    {{ $.Scratch.Set "back" ("/recommendations/" | relURL) }}
    {{ end }}
    {{ end }}
    {{ $back := $.Scratch.Get "back" }}
    {{ if $back }}
    <p class="mb-4"><a class="nav-link" href="{{ $back }}">‚Üê Back to all</a></p>
    {{ end }}
    {{ if .Params.link }}
    <a class="btn" href="{{ .Params.link }}" target="_blank" rel="noopener">Visit Website</a>
    {{ end }}
    <div class="mt-3 flex flex-wrap gap-2">
      {{ range .Params.categories }}<a
        class="text-xs bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 px-2 py-1 rounded"
        href="{{ (printf " /categories/%s/" (urlize .) | relURL) }}">{{ . }}</a>{{ end }}
      {{ range .Params.tags }}<a
        class="text-xs bg-slate-50 dark:bg-slate-900 text-slate-600 dark:text-slate-300 px-2 py-1 rounded border border-slate-200 dark:border-slate-800"
        href="{{ (printf " /tags/%s/" (urlize .) | relURL) }}">#{{ . }}</a>{{ end }}
    </div>
  </header>

  {{ $img := .Params.image }}
  {{ if $img }}
  {{ if or (hasPrefix $img "http://") (hasPrefix $img "https://") }}
  <img class="w-full max-h-72 object-contain mb-6" src="{{ $img }}" alt="{{ $.Title }} image" loading="lazy"
    decoding="async" />
  {{ else }}
  <img class="w-full max-h-72 object-contain mb-6" src="{{ $img | relURL }}" alt="{{ $.Title }} image" loading="lazy"
    decoding="async" />
  {{ end }}
  {{ else }}
  {{ $resources := .Resources.ByType "image" }}
  {{ with first 1 $resources }}
  {{ $r := index . 0 }}
  {{ $webp := $r.Resize "800x webp q85" }}
  {{ $fallback := $r.Resize "800x q85" }}
  <picture>
    <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
    <img class="w-full max-h-72 object-contain mb-6" src="{{ $fallback.RelPermalink }}" alt="{{ $.Title }} image" />
  </picture>
  {{ end }}
  {{ end }}

  <div class="prose prose-slate dark:prose-invert max-w-none">
    {{ .Content }}
  </div>
</article>
{{ end }}