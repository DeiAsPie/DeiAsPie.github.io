<!doctype html>
<html lang="en" class="h-full">
    <head>
        {{ partial "head.html" . }}
    </head>

    <body
        class="min-h-full bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100"
    >
        <div class="mx-auto max-w-3xl px-4 sm:px-6 lg:max-w-6xl">
            {{ partial "header.html" . }}
            <main id="main" class="py-10">{{ block "main" . }}{{ end }}</main>
            {{ partial "footer.html" . }}
        </div>
        <script>
            // Initialize UI (theme toggle + mobile menu) in a robust way.
            // Add minimal console diagnostics so we can see whether the init runs in production.
            (function () {
                function initUI() {
                    try {
                        console.log("initUI: running", { readyState: document.readyState });
                    } catch (e) {}

                    // Theme toggle: sync aria-pressed; icons switch via CSS (dark: classes)
                    var btn = document.getElementById("theme-toggle");
                    if (btn) {
                        try {
                            console.log("initUI: found theme-toggle button");
                        } catch (e) {}

                        function syncState() {
                            var isDark = document.documentElement.classList.contains("dark");
                            btn.setAttribute("aria-pressed", isDark ? "true" : "false");
                        }
                        syncState();
                        btn.addEventListener("click", function () {
                            try { console.log("theme-toggle: click - before", { htmlClass: document.documentElement.className, ariaPressed: btn.getAttribute("aria-pressed") }); } catch (e) {}
                            var isDark = document.documentElement.classList.toggle("dark");
                            try {
                                localStorage.setItem("theme", isDark ? "dark" : "light");
                            } catch (e) {}
                            syncState();
                            try { console.log("theme-toggle: click - after", { htmlClass: document.documentElement.className, ariaPressed: btn.getAttribute("aria-pressed") }); } catch (e) {}
                        });
                    } else {
                        try {
                            console.log("initUI: theme-toggle button not found");
                        } catch (e) {}
                    }

                    // Mobile menu toggle
                    var toggle = document.getElementById("mobile-menu-toggle");
                    var menu = document.getElementById("mobile-menu");
                    if (toggle && menu) {
                        try {
                            console.log("initUI: found mobile menu toggle and menu");
                        } catch (e) {}

                        toggle.addEventListener("click", function () {
                            try { console.log("mobile-toggle: click - before", { menuClass: menu.className, ariaExpanded: toggle.getAttribute("aria-expanded") }); } catch (e) {}
                            var isHidden = menu.classList.toggle("hidden");
                            toggle.setAttribute("aria-expanded", isHidden ? "false" : "true");
                            try { console.log("mobile-toggle: click - after", { menuClass: menu.className, ariaExpanded: toggle.getAttribute("aria-expanded") }); } catch (e) {}
                        });

                        // Ensure hamburger menu is properly hidden on resize to desktop
                        function handleResize() {
                            if (window.innerWidth >= 768) {
                                // md breakpoint
                                menu.classList.add("hidden");
                                toggle.setAttribute("aria-expanded", "false");
                            }
                        }
                        window.addEventListener("resize", handleResize);
                        handleResize(); // Call once on load
                    } else {
                        try {
                            console.log("initUI: mobile menu toggle or menu not found", { toggle: !!toggle, menu: !!menu });
                        } catch (e) {}
                    }

                    // Mark UI ready to allow theme transition effects after first paint
                    try { document.documentElement.classList.add("ui-ready"); } catch (e) {}
                }

                if (document.readyState === "loading") {
                    document.addEventListener("DOMContentLoaded", initUI);
                } else {
                    initUI();
                }
            })();
        </script>
        <script>
            // Prefetch nav targets on first intent (hover/focus)
            (function () {
                try {
                    var supports =
                        "relList" in HTMLLinkElement.prototype &&
                        HTMLLinkElement.prototype.relList.supports &&
                        HTMLLinkElement.prototype.relList.supports("prefetch");
                    if (!supports) return;
                } catch (e) {
                    return;
                }
                var seen = new Set();
                function add(href) {
                    if (
                        seen.has(href) ||
                        href.indexOf("#") > -1 ||
                        href.startsWith("mailto:")
                    )
                        return;
                    seen.add(href);
                    var l = document.createElement("link");
                    l.rel = "prefetch";
                    l.href = href;
                    l.as = "document";
                    document.head.appendChild(l);
                }
                function bind(a) {
                    var href = a.getAttribute("href");
                    if (!href || href.charAt(0) !== "/") return;
                    var h = function () {
                        add(href);
                    };
                    a.addEventListener("pointerenter", h, { once: true });
                    a.addEventListener("focus", h, { once: true });
                }
                document.querySelectorAll("nav a[href]").forEach(bind);
            })();
        </script>
    </body>
</html>
