{{/* Copied from theme's head.html and extended: hardened CSP rollout */}} 
{{ partial "style" (dict "path" "gen/tailwind.css") }} 
{{ partial "script" (dict "path" "js/init-theme.js") }} 

{{ $styleSources := .Site.Params.security.csp.style_src | default "'self'" }} 
{{ $fontSources := .Site.Params.security.csp.font_src | default "'self'" }} 

{{ if .Site.Params.googleFonts }} 
  {{ $styleSources = printf "%s %s" $styleSources "https://fonts.googleapis.com" }} 
  {{ $fontSources = printf "%s %s" $fontSources "https://fonts.gstatic.com" }} 
{{ end }} 

{{ $directives := slice
  (printf "default-src %s" (.Site.Params.security.csp.default_src | default "'self'"))
  (printf "script-src %s" (.Site.Params.security.csp.script_src | default "'self'"))
  (printf "style-src %s" $styleSources)
  (printf "style-src-attr %s" (.Site.Params.security.csp.style_src_attr | default "'unsafe-inline'"))
  (printf "img-src %s" (.Site.Params.security.csp.img_src | default "'self' https: data:"))
  (printf "font-src %s" $fontSources)
  (printf "connect-src %s" (.Site.Params.security.csp.connect_src | default "'self'"))
  (printf "base-uri %s" (.Site.Params.security.csp.base_uri | default "'self'"))
  (printf "form-action %s" (.Site.Params.security.csp.form_action | default "'none'"))
  (printf "frame-src %s" (.Site.Params.security.csp.frame_src | default "'none'"))
  (printf "object-src %s" (.Site.Params.security.csp.object_src | default "'none'"))
}}

{{ if .Site.Params.security.csp.upgrade_insecure_requests }}
  {{ $directives = $directives | append "upgrade-insecure-requests" }}
{{ end }}

{{ $csp := delimit $directives "; " }}
<meta http-equiv="Content-Security-Policy" content="{{ $csp }}" />
<meta http-equiv="Referrer-Policy" content="no-referrer-when-downgrade" />
<meta http-equiv="X-Content-Type-Options" content="nosniff" />

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>{{ if .Title }}{{ .Title }} | {{ end }}{{ .Site.Title }}</title>
{{ $desc := "" }} {{ with .Params.description }}{{ $desc = . | plainify |
htmlEscape }}{{ end }} {{ if and (eq $desc "") (.Params.summary) }}{{ $desc =
(.Params.summary | plainify | htmlEscape) }}{{ end }} {{ if and (eq $desc "")
(.Summary) }}{{ $desc = (.Summary | plainify | htmlEscape) }}{{ end }} {{ if and
(eq $desc "") (.Site.Params.description) }}{{ $desc = (.Site.Params.description
| plainify | htmlEscape) }}{{ end }} {{ if eq $desc "" }}{{ $desc = (.Site.Title
| plainify | htmlEscape) }}{{ end }}
<meta name="description" content="{{ $desc }}" />
<meta name="author" content="{{ .Site.Params.author }}" />
<link rel="canonical" href="{{ .Permalink }}" />
<link rel="icon" href='{{ "/favicon.svg" | relURL }}' type="image/svg+xml" />
<link rel="apple-touch-icon" href='{{ "/favicon.svg" | relURL }}' />
<meta name="theme-color" content="#0f172a" />

{{ $absURL := .Permalink }}
<meta
  property="og:type"
  content="{{ if .IsPage }}article{{ else }}website{{ end }}"
/>
<meta property="og:url" content="{{ $absURL }}" />
<meta
  property="og:title"
  content="{{ if .Title }}{{ .Title }} | {{ end }}{{ .Site.Title }}"
/>
<meta property="og:description" content="{{ $desc }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />
{{ $ogimg := "" }} {{ if .Params.image }} {{ if or (hasPrefix .Params.image
"http://") (hasPrefix .Params.image "https://") }} {{ $ogimg = .Params.image }}
{{ else }} {{ $ogimg = (.Params.image | absURL) }} {{ end }} {{ else }} {{ $res
:= .Resources.ByType "image" }} {{ with first 1 $res }} {{ $first := index . 0
}} {{ $ogimg = ($first.Permalink) }} {{ else }} {{ $ogimg = ("/favicon.svg" |
absURL) }} {{ end }} {{ end }}
<meta property="og:image" content="{{ $ogimg }}" />
<meta name="twitter:card" content="summary_large_image" />
<meta
  name="twitter:title"
  content="{{ if .Title }}{{ .Title }} | {{ end }}{{ .Site.Title }}"
/>
<meta name="twitter:description" content="{{ $desc }}" />
<meta name="twitter:image" content="{{ $ogimg }}" />
<link
  rel="alternate"
  type="application/rss+xml"
  href="{{ .Site.BaseURL }}index.xml"
  title="RSS"
/>
<link rel="manifest" href="/manifest.json" />
{{ partial "fonts.html" . }} {{ if .IsHome }} {{ with .Site.Params.prefetch }}
{{ $current := $.RelPermalink }} {{ range . }} {{ if ne . $current }}
<link rel="prefetch" href="{{ . | relURL }}" as="document" />
{{ end }} {{ end }} {{ end }} {{ end }} {{ if and (not .IsHome) (not .IsNode) }}
{{ partial "seo-jsonld.html" . }} {{ else if .IsPage }} {{ partial
"seo-jsonld.html" . }} {{ end }}
