/* Tailwind v4 CSS entrypoint */
@config "../../tailwind.config.js";
@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* Tell Tailwind where to scan for class usage (v4) */
@source "./content/**/*.{html,md}";
@source "./layouts/**/*.html";
@source "./assets/js/**/*.js";

/* Use class-based dark mode: apply `dark:` utilities when `.dark` is on an ancestor */
@custom-variant dark (&:where(.dark, .dark *));

/* Allow @apply to reference Tailwind utilities (Tailwind v4) */
@reference "tailwindcss";

/* Design tokens - CSS custom properties for maintainability */
:root {
  color-scheme: light dark;

  /* Core semantic colors */
  --color-text-primary: theme(colors.slate.900);
  --color-text-secondary: theme(colors.slate.700);
  --color-text-tertiary: theme(colors.slate.500);
  --color-text-accent: theme(colors.slate.800);

  --color-bg-primary: theme(colors.white);
  --color-bg-secondary: theme(colors.slate.100);
  --color-bg-tertiary: theme(colors.slate.50);

  --color-border-primary: theme(colors.slate.200);
  --color-border-secondary: theme(colors.slate.300);

  --color-interactive-primary: theme(colors.slate.900);
  --color-interactive-hover: theme(colors.slate.700);

  /* Focus ring system */
  --color-focus-ring: theme(colors.sky.500);
  --color-focus-ring-offset: theme(colors.white);
  --color-focus-ring-special: theme(colors.fuchsia.500);

  /* Spacing tokens */
  --space-xs: theme(spacing.1);
  --space-sm: theme(spacing.2);
  --space-md: theme(spacing.4);
  --space-lg: theme(spacing.6);
  --space-xl: theme(spacing.8);
  --space-2xl: theme(spacing.10);

  /* Border radius tokens */
  --radius-sm: theme(borderRadius.md);
  --radius-md: theme(borderRadius.lg);
  --radius-lg: theme(borderRadius.xl);
  --radius-xl: theme(borderRadius.2xl);

  /* Shadow tokens */
  --shadow-sm: theme(boxShadow.sm);
  --shadow-md: theme(boxShadow.DEFAULT);
  --shadow-lg: theme(boxShadow.lg);
}

/* Dark mode overrides */
.dark {
  --color-text-primary: theme(colors.white);
  --color-text-secondary: theme(colors.slate.300);
  --color-text-tertiary: theme(colors.slate.400);
  --color-text-accent: theme(colors.slate.200);

  --color-bg-primary: theme(colors.slate.900);
  --color-bg-secondary: theme(colors.slate.800);
  --color-bg-tertiary: theme(colors.slate.950);

  --color-border-primary: theme(colors.slate.800);
  --color-border-secondary: theme(colors.slate.700);

  --color-interactive-primary: theme(colors.slate.200);
  --color-interactive-hover: theme(colors.white);

  --color-focus-ring: theme(colors.sky.400);
  --color-focus-ring-offset: theme(colors.slate.950);
  --color-focus-ring-special: theme(colors.fuchsia.400);
}

.prose img {
  border-radius: 0.375rem;
}

/* LQIP blur-up wrapper — blurred background shows while image loads.
   The 20x webp q20 placeholder is already blurred by Hugo's `blur 20`
   parameter + natural browser upscaling smoothing — no CSS filter needed.
   When the <img> loads, it paints opaquely over the background. */
.lqip-wrap {
  display: inline-block;
  position: relative;
  overflow: hidden;
  line-height: 0;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
}

.lqip-img {
  display: block;
  position: relative;
  z-index: 1;
}

/* Rich typography for content areas */
.prose {
  @apply max-w-none;
  /* let layouts control width */
}

.prose h1 {
  /* Remove gradient/text-transparent so native emoji keep their color */
  @apply text-3xl font-bold tracking-tight mb-4;
  color: var(--color-text-primary);
}

.prose h2 {
  @apply text-2xl font-semibold mt-10 mb-4;
  color: var(--color-text-primary);
}

.prose h3 {
  @apply text-xl font-semibold mt-8 mb-3;
  color: var(--color-text-primary);
}

.prose p {
  @apply leading-7 text-slate-700 dark:text-slate-300 mb-4;
}

.prose a {
  @apply underline underline-offset-4 decoration-slate-300 dark:decoration-slate-600 hover:decoration-slate-500 dark:hover:decoration-slate-400 transition-colors;
}

.prose strong {
  @apply font-semibold text-slate-900 dark:text-slate-100;
}

.prose em {
  @apply text-slate-800 dark:text-slate-200;
}

.prose blockquote {
  @apply relative my-6 pl-4 border-l-4 border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-300 italic;
}

.prose ul,
.prose ol {
  @apply my-4 pl-6 space-y-2;
}

.prose li::marker {
  @apply text-slate-500 dark:text-slate-400;
}

.prose code {
  @apply rounded px-1.5 py-0.5 text-sm bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200;
}

.prose pre {
  @apply my-6 p-4 rounded-lg bg-slate-950/95 text-slate-100 overflow-x-auto;
}

.prose pre code {
  @apply bg-transparent p-0 text-inherit;
}

.prose hr {
  @apply my-8 border-slate-200 dark:border-slate-800;
}

.prose table {
  @apply w-full text-left border-collapse my-6 overflow-hidden rounded-lg;
}

.prose thead {
  @apply bg-slate-100 dark:bg-slate-900;
}

.prose th,
.prose td {
  @apply border border-slate-200 dark:border-slate-800 px-3 py-2 align-top;
}

.prose figcaption {
  @apply text-sm text-slate-500 dark:text-slate-400 mt-2 text-center;
}

/* Anchored headings shouldn't hide under sticky header */
.prose h1[id],
.prose h2[id],
.prose h3[id],
.prose h4[id],
.prose h5[id],
.prose h6[id] {
  scroll-margin-top: 5rem;
}

/* Table of contents styling */
.toc {
  @apply text-sm leading-6;
}

.toc ul {
  @apply space-y-1 my-0 pl-4;
}

.toc > ul {
  @apply pl-0;
}

.toc a {
  @apply text-slate-700 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white underline-offset-4 hover:underline;
}

/* Card component */
.card {
  @apply rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow hover:shadow-lg transition-shadow overflow-hidden;
}

.card-body {
  @apply p-5;
}

.card-title {
  @apply text-lg font-semibold mb-1;
}

.card-meta {
  @apply text-sm text-slate-500 dark:text-slate-400;
}

/* Card images */
img.card-img {
  /* Ensure padding doesn't increase the visual width and images are centered */
  @apply box-border block w-full h-40 max-h-40 object-contain object-center p-4;
}

/* Buttons */
.btn {
  @apply inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-white bg-slate-900 hover:bg-slate-700 dark:bg-slate-200 dark:text-slate-900 dark:hover:bg-white transition-colors;
}

/* Header nav */
.nav-link {
  @apply relative text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white transition-colors;
}

/* Animated underline on hover */
.nav-link::after {
  content: "";
  @apply absolute left-0 -bottom-0.5 h-0.5 w-0 bg-slate-900 dark:bg-white transition-all duration-200;
}

.nav-link:hover::after {
  @apply w-full;
}

/* Icon button */
.icon-btn {
  /* Do not set display here; let utilities like inline-flex and md:hidden control visibility */
  @apply items-center justify-center rounded-md p-2 text-slate-700 hover:text-slate-900 dark:text-slate-200 dark:hover:text-white border border-slate-200 dark:border-slate-700 bg-white/60 dark:bg-slate-900/60 backdrop-blur transition-colors;
}

/* Enhanced accessible focus styles */
/* Use focus-visible to avoid double focus on mouse interactions. Provide strong contrast and consistent ring. */
a:focus-visible,
button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
.icon-btn:focus-visible,
.btn:focus-visible,
.nav-link:focus-visible {
  @apply outline-none ring-2 ring-offset-2 rounded-md;
  --tw-ring-color: var(--color-focus-ring);
  --tw-ring-offset-color: var(--color-focus-ring-offset);
}

/* Provide visible indication also for keyboard focus on skip link (already uses sr-only) */
a[href="#main"]:focus-visible {
  @apply ring-2 ring-offset-2;
  --tw-ring-color: var(--color-focus-ring-special);
  --tw-ring-offset-color: var(--color-focus-ring-offset);
}

/* Theme transitions (enabled only after first paint to avoid FOUC) */
@media (prefers-reduced-motion: no-preference) {

  .ui-ready body,
  .ui-ready .card,
  .ui-ready .prose,
  .ui-ready .nav-link,
  .ui-ready .btn,
  .ui-ready .icon-btn {
    transition:
      background-color 200ms,
      color 200ms,
      border-color 200ms,
      box-shadow 200ms;
  }
}

/* Ensure explicit font-size for headings inside semantic sectioning elements
   to avoid Lighthouse deprecated-API warnings when browsers change UA
   defaults. Uses clamp() so UA defaults are overridden and Lighthouse sees a
   concrete font-size property. */
article h1,
section h1,
nav h1,
aside h1 {
  font-size: clamp(1.5rem, 2.5vw, 2.25rem);
}

article h2,
section h2,
nav h2,
aside h2 {
  font-size: clamp(1.25rem, 2vw, 1.75rem);
}

article h3,
section h3,
nav h3,
aside h3 {
  font-size: clamp(1.125rem, 1.5vw, 1.5rem);
}
